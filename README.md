# Better Synth æ¯”èµ›å¼€å‘å¥—ä»¶

1. ä¾èµ–å®‰è£…
- æ¨èä½¿ç”¨ conda ç¯å¢ƒ
```shell
conda create -n dj python=3.10
conda activate dj

bash install.sh
```

2. æ¯”èµ›èµ„æºä¸‹è½½
- ä¸‹è½½åŸºç¡€æ¨¡å‹ï¼Œç§å­/å¾®è°ƒ/è¯„æµ‹æ•°æ®é›†
- åŸºç¡€æ¨¡å‹ä¸å¾®è°ƒæ•°æ®é›†å‡å­˜æ”¾äºè®­ç»ƒç›®å½•ä¸­æŒ‡å®šä½ç½®
- ç§å­æ•°æ®é›†å­˜æ”¾äº`input`ç›®å½•
- è¯„æµ‹æ•°æ®é›†å­˜æ”¾äº`toolkit/eval`ç›®å½•
```shell
bash download.sh
```

3. æ•°æ®å¤„ç†ä¸åˆæˆ
- æ¯”èµ›è¦æ±‚ä½¿ç”¨ [data-juicer](https://github.com/modelscope/data-juicer) åŸºäºä¸Šä¸€æ­¥ä¸­ä¸‹è½½çš„**ç§å­æ•°æ®é›†**è¿›è¡Œæ•°æ®å¤„ç†ä¸åˆæˆ
- æ•°æ®å¤„ç†ä¸åˆæˆç›¸å…³ä»£ç è¯·å­˜æ”¾äº`solution`ç›®å½•ä¸­ï¼Œå¹¶åœ¨`solution/requirements.txt`ä¸­æ·»åŠ æ‰€éœ€çš„ä¾èµ–
- æœ€åä¹Ÿè¯·åœ¨`solution/readme`ä¸­è¯¦ç»†ä»‹ç»æ‰€ä½¿ç”¨çš„æ•°æ®å¤„ç†ä¸åˆæˆæ–¹æ¡ˆ
- å¤„ç†åçš„æ•°æ®é›†éœ€æŒ‰ç…§å¦‚ä¸‹ç»“æ„å­˜æ”¾ï¼š
```
ğŸ“¦ output/
â”œâ”€â”€ ğŸ“‚ processed_data/
â”‚       â”œâ”€â”€ ğŸ“‚ synthetic_images/ (if any)
â”‚       â””â”€â”€ ğŸ“„ processed_data.jsonl
â”‚ ...
```
- `processed_data.jsonl`éœ€ä¸ºæ ‡å‡†çš„`JSONL`æ ¼å¼ï¼Œä¾‹å¦‚ï¼š
```json lines
{"images": ["images/00237/002375592.jpg"], "text": "<image>\nadorable pink and gray elephant themed party favour boxes with tissue fillers <|__dj__eoc|>", "id": "002375592"}
{"images": ["images/00199/001999195.jpg"], "text": "<image>\nbreccinano adult dog food for all ages with turkey, lamb and venisi <|__dj__eoc|>", "id": "001999195"}
...
```

4. æ‰§è¡Œæ¨¡å‹è®­ç»ƒ/æ¨ç†
- æ¨¡å‹è®­ç»ƒä¸æ¨ç†
```shell
cd toolkit/

# è¯·æ ¹æ®è‡ªèº«éœ€æ±‚ä¿®æ”¹è®­ç»ƒè„šæœ¬train_mgm_2b_stage_1.shå†…çš„å‚æ•°
# æ‚¨åªèƒ½ä¿®æ”¹ä»¥ä¸‹èŒƒå›´å†…çš„å‚æ•°

############################################################################
########################### Editable Part Begins ###########################
############################################################################
# å¯ä¿®æ”¹å‚æ•°èŒƒå›´
############################################################################
############################ Editable Part Ends ############################
############################################################################

# ä¿®æ”¹å®Œæ¯•åæ‰§è¡Œè®­ç»ƒä¸æ¨ç†è„šæœ¬
bash train_mgm_2b_stage_1.sh
```
- è®­ç»ƒä¸æ¨ç†ç»“æŸåï¼Œä¼šåœ¨`output`ç›®å½•ä¸­äº§å‡ºè®­ç»ƒå¥½çš„æ¨¡å‹ä»¥åŠè¯„æµ‹é›†æ¨ç†ç»“æœ
  - è®­ç»ƒåçš„æ¨¡å‹å­˜æ”¾äºï¼š`output/training_dirs`
  - æ¨ç†ç»“æœå­˜æ”¾äºï¼š`output/eval_results`

5. çº¿ä¸Šèµ›æäº¤ç»“æœ

çº¿ä¸Šèµ›åªéœ€è¦æäº¤solutionï¼Œè®­ç»ƒè„šæœ¬ï¼Œè®­ç»ƒæ—¥å¿—ï¼ˆpretrainå’Œfinetuningï¼‰ï¼Œä»¥åŠè¯„æµ‹æ¨ç†ç»“æœ 
- è¯·å°†æ•°æ®å¤„ç†æ–¹æ¡ˆã€è®­ç»ƒåŠæ¨ç†è„šæœ¬ã€è®­ç»ƒæ—¥å¿—ã€æ¨ç†ç»“æœæ‰“åŒ…æˆä¸€ä¸ª zip æ–‡ä»¶ï¼Œä¸Šä¼ è‡³å¤©æ± å¹³å°è¿›è¡Œè¯„æµ‹ã€‚
- ä¸ºä¿è¯æäº¤çš„è§„èŒƒæ€§ï¼ŒåŠ¡å¿…éµå¾ªä»¥ä¸‹æ–‡ä»¶æ‰“åŒ…ç»“æ„å¹¶æäº¤ä»¥ä¸‹æ‰€éœ€çš„æ–‡ä»¶ï¼Œè¯·å‹¿æ·»åŠ é¢å¤–çš„é¡¶çº§ç›®å½•ã€‚

```text
submit.zip
â”œâ”€â”€ solution
â”‚   â”œâ”€â”€ readme                                  ########## ä»‹ç»æ‚¨çš„ç®—æ³•è®¾è®¡å’Œæ‰§è¡Œæµç¨‹ ########## 
â”‚   â”œâ”€â”€ requirements.txt                        ########## ç¬¬ä¸‰æ–¹ pip ä¾èµ–åº“ ########## 
â”‚   â””â”€â”€ ...
â””â”€â”€ output
    â”œâ”€â”€ train.sh                                ########## è®­ç»ƒè„šæœ¬ ##########
    â”œâ”€â”€ training_dirs
    â”‚   â”œâ”€â”€ MGM-2B-Pretrain-xxxx                ########## é¢„è®­ç»ƒå¥½çš„æ¨¡å‹ ##########
    â”‚   â”‚   â””â”€â”€ pretrain.log                    ########## é¢„è®­ç»ƒæ—¥å¿— ##########
    â”‚   â””â”€â”€ MGM-2B-Finetune-xxxx								########## å¾®è°ƒå¥½çš„æ¨¡å‹ ########## 	
    â”‚       â””â”€â”€ finetune.log                    ########## å¾®è°ƒè®­ç»ƒæ—¥å¿— ##########
    â””â”€â”€ eval_results                            ########## æ¨ç†ç»“æœ ##########
        â””â”€â”€ MGM-2B-Finetune-xxxx
```

6. çº¿ä¸‹èµ›æäº¤ç»“æœ

- è¯·å°†æ•°æ®å¤„ç†æ–¹æ¡ˆã€è®­ç»ƒä¸æ¨ç†è„šæœ¬ã€å¤„ç†ä¸åˆæˆçš„æ•°æ®ã€æ¨¡å‹checkpointã€æ¨ç†ç»“æœç­‰æ‰“åŒ…ä¸ºä¸€ä¸ªzipæ–‡ä»¶ï¼Œä¸Šä¼ åˆ°å¤©æ± å¹³å°è¿›è¡Œè¯„æµ‹
```shell
zip -r submit.zip solution/ output/
```
- ä¸ºä¿è¯æäº¤çš„è§„èŒƒæ€§ï¼ŒåŠ¡å¿…éµå¾ªä»¥ä¸‹æ–‡ä»¶æ‰“åŒ…ç»“æ„å¹¶æäº¤ä»¥ä¸‹æ‰€éœ€æ–‡ä»¶ï¼Œè¯·å‹¿æ·»åŠ é¢å¤–çš„é¡¶å±‚ç›®å½•
```text
submit.zip
â”œâ”€â”€ solution
â”‚   â”œâ”€â”€ readme                                  ########## ä»‹ç»æ‚¨çš„ç®—æ³•è®¾è®¡å’Œæ‰§è¡Œæµç¨‹ ########## 
â”‚   â”œâ”€â”€ requirements.txt                        ########## ç¬¬ä¸‰æ–¹ pip ä¾èµ–åº“ ########## 
â”‚   â”œâ”€â”€ ...
â””â”€â”€ output
    â”œâ”€â”€ train.sh                                ########## è®­ç»ƒè„šæœ¬ ########## 
    â”œâ”€â”€ processed_data
    â”‚   â”œâ”€â”€ synthetic_images/                   ########## åˆæˆçš„å›¾ç‰‡æ•°æ®ï¼ˆå¦‚æœ‰ï¼‰ ########## 
    â”‚   â””â”€â”€ processed_data.jsonl                ########## ç”¨äºè®­ç»ƒçš„å¤„ç†ä¸åˆæˆçš„æ•°æ®æ–‡ä»¶ ##########
    â”œâ”€â”€ training_dirs
    â”‚   â”œâ”€â”€ MGM-2B-Pretrain-xxxx                ########## é¢„è®­ç»ƒå¥½çš„æ¨¡å‹ ##########
    â”‚   â”‚   â”œâ”€â”€ pretrain.log                    ########## é¢„è®­ç»ƒæ—¥å¿— ########## 
    â”‚   â”‚   â””â”€â”€ mm_projector.bin
    â”‚   â””â”€â”€ MGM-2B-Finetune-xxxx				########## å¾®è°ƒå¥½çš„æ¨¡å‹ ########## 	
    â”‚       â”œâ”€â”€ finetune.log                    ########## å¾®è°ƒè®­ç»ƒæ—¥å¿— ##########	  
    â”‚       â””â”€â”€ model-xxx.safetensors  
    â””â”€â”€ eval_results                            ########## æ¨ç†ç»“æœ ##########
        â””â”€â”€ MGM-2B-Finetune-xxxx
```

### 10k Baseline
10k Baselineæ˜¯ä¸ºäº†ç»™åˆçº§é€‰æ‰‹ä½“éªŒå’Œå‚ä¸æ¯”èµ›çš„ä¸€ä¸ªå¿«é€ŸåŸºçº¿è¿‡ç¨‹ã€‚ä¸æ ‡å‡†æ¯”èµ›æµç¨‹ä¸åŒï¼Œè¦ä½“éªŒå’Œèµ°é€š10kå¿«é€ŸåŸºçº¿æµç¨‹çš„é€‰æ‰‹ä»¬å¯ä»¥æŠŠæ ‡å‡†æµç¨‹ä¸­çš„ä»¥ä¸‹æ­¥éª¤æ–‡ä»¶æ›¿æ¢ä¸ºå¸¦æœ‰`_10k_baseline`åç¼€çš„ç‰ˆæœ¬ï¼ŒåŒ…æ‹¬ï¼š
1. æ¯”èµ›èµ„æºä¸‹è½½æ—¶ï¼Œè¿è¡Œè„šæœ¬ä¸ºï¼š`download_10k_baseline.sh`
2. è®­ç»ƒæ¨¡å‹æ—¶ï¼Œéœ€ä¿®æ”¹å’Œè¿è¡Œçš„è®­ç»ƒè„šæœ¬ä¸ºï¼š`toolkit/train_mgm_2b_stage_1_10k_baseline.sh`
æ­¤å¤–ï¼Œå¥—ä»¶ä¸­è¿˜æä¾›äº†ä¸€ä¸ªJupyter Notebookæ¥å¸®åŠ©é€‰æ‰‹å¿«é€Ÿä»10kåŸºçº¿ä¸­ç†Ÿæ‚‰æ¯”èµ›åŸºæœ¬æµç¨‹ï¼Œå¹¶æäº¤baselineï¼Œå¯å‚è€ƒ`10k_quick_baseline.ipynb`